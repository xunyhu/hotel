# 接口开发

## 一、接口设计

1️⃣ 权限 & 用户管理

    登录认证

    POST /api/auth/login
    Request: { "username": "admin", "password": "123456" }
    Response: { "token": "xxx", "role": "超级管理员" }

    获取当前用户信息

    GET /api/auth/me
    Response: 用户基础信息 + 权限

    用户管理（管理员用）

    GET /api/admin/users → 获取用户列表

    POST /api/admin/users → 新增用户

    PUT /api/admin/users/:id → 修改用户

    DELETE /api/admin/users/:id → 删除用户
    

2️⃣ 菜品管理

    ```
    菜单浏览（C端）

    GET /api/dishes → 获取菜品列表（支持查询 category, status）

    GET /api/dishes/:id → 获取菜品详情

    管理端

    POST /api/admin/dishes
    Request: { "name":"宫保鸡丁", "price":28, "category":"热菜", "stock":100, "image_url":"/img.jpg", "status":1 }

    PUT /api/admin/dishes/:id → 修改菜品

    DELETE /api/admin/dishes/:id → 删除菜品
    ```

## 二、接口与表的映射

| 接口                  | 表                                   |
| ------------------- | ----------------------------------- |
| /api/auth/login     | users, roles                        |
| /api/admin/users    | users, roles                        |
| /api/dishes         | dishes                              |
| /api/orders         | orders, order\_items, dishes        |
| /api/reviews        | reviews, orders, users              |
| /api/pay/\*         | orders                              |
| /api/admin/stats/\* | orders, order\_items, dishes, users |

## 三、目录结构

    ```bash
    backend/
    ├── package.json
    ├── .env                  # 环境变量 (数据库、密钥等)
    ├── src/
    │   ├── index.js          # 应用入口
    │   ├── config/           # 配置文件
    │   │   └── db.js         # 数据库连接 (mysql2/sequelize)
    │   ├── models/           # 数据库模型
    │   │   ├── Role.js
    │   │   ├── User.js
    │   │   ├── Dish.js
    │   │   ├── Order.js
    │   │   ├── OrderItem.js
    │   │   └── Review.js
    │   ├── routes/           # 路由定义
    │   │   ├── authRoutes.js
    │   │   ├── userRoutes.js
    │   │   ├── menuRoutes.js
    │   │   ├── orderRoutes.js
    │   │   ├── reviewRoutes.js
    │   │   └── adminRoutes.js
    │   ├── controllers/      # 控制器 (业务逻辑)
    │   │   ├── authController.js
    │   │   ├── userController.js
    │   │   ├── menuController.js
    │   │   ├── orderController.js
    │   │   ├── reviewController.js
    │   │   └── adminController.js
    │   ├── middleware/       # 中间件
    │   │   ├── authMiddleware.js   # JWT 验证
    │   │   └── roleMiddleware.js   # 角色/权限验证
    │   ├── utils/            # 工具类
    │   │   ├── jwt.js
    │   │   └── bcrypt.js
    │   └── services/         # 第三方服务 (比如微信支付)
    │       └── wechatPay.js

    ```
